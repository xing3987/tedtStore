

ssm-学子商城
	1.建立项目，配置环境
	2.创建文件夹结构
		实体：bean
		控制器：controller(在spring-mvc.xml中添加组件扫描)
		业务层：service(在spring-service.xml中添加服务层扫描)
		持久层:mapper(在spirng-dao.xml中添加接口扫描和映射文件扫描)
	3.导包
		spring-webmvc
		spring-jdbc
		mybatis
		mybatis-spring
		mysql
		commons-dbcp
		junit
		jaskson*3(异步ajax)
		jstl
	4.添加资源文件
		resources中添加属性文件	db.properties	spring-mvc.xml
		在resources中创建文件夹：mappers用于管理映射文件	
	5.配置web.xml添加dispatcherServlet, filter编码
	
***用户管理****
	1.表设计
		id   		int 				auto_increment primary key;
		username 	varchar(50)			not null unique
		password	varchar(50)			not null
		email		varchar(50)			not null
		phone		varchar(32)			not null
		image		varchar(100)						
		gender		int					0表示男,1表示女
		created_user varchar(50)
		created_time date
		modified_user varchar(50)
		modified_time date
		
	2.注册
		--创建实体类：在bean包中创建user,增加表对应字段并增加构造方法等
		--持久层：
			a.在mapper包定义接口：接口UserMap接口，并且在接口中定义insert方法
			b.在mappers文件夹中创建UserMapper.xml指定namespace
				在其中写插入语句，查询语句
			c.写测试类，测试插入，查询语句的正确性(test.java)
		--业务层
			a.创建接口IUserService,在接口中定义业务方法：register方法
				public interface IUserService{
					void register(User user);
				}
			b.创建IUserService接口的实现类：UserService，实现接口中的方法	
			c.在service.ex包中创建ClassNameAlreadyExistException异常继承RuntimeException
			d.测试UserService是否正确(test.java)
			
		--用户注册,用户名，邮箱，电话号码,用户名的验证
			a.邮箱持久层，在UserMapper接口中定义方法：验证邮箱是否存在。
				Integer selectByEmail(String email);
			b.在UserMapper.xml中定义select节点，根据邮箱查询是否存在
				返回数据类型为 java.lang.Integer
	
	3.定义通用的响应结束类ResponseResult定义到bean包中(实现序列化接口)
		包含状态码，返回信息提示，返回数据
				
	4.控制器的5个请求方法
		a.	/user/showRegister.do--显示页面
			请求参数：无
			请求方式：get
			响应方式：转发	
		b.	/user/checkUsername.do--异步请求确认用户名
			请求参数：username
			请求方式：get
			响应方式：ResponseBody
		c.	/user/checkEmail.do--异步请求确认邮箱
			请求参数：email
			请求方式：get
			响应方式：ResponseBody
		d.	/user/checkPhone.do--异步请求确认电话	
			请求参数：phone
			请求方式：get
			响应方式：ResponseBody
		e.	/user/register.do--确认登陆跳转
			请求参数：form数据
			请求方式：post
			响应方式：ResponseBody(状态码为1时通过location进行页面跳转)
		
	5.在register.jsp页面中实现用户，邮箱，手机号的异步提交(ajax)	
	
	6.用户注册，提交按钮的控制器方法(异步提交)
			register.jsp页面中该提交方法ajax的书写
			
   	**用户登陆**
   	1.登陆-持久层
   	2.登陆-业务层
   		在UserService类中实现login方法
   			a.调用持久层selectByUsername()方法，返回值User
   			b.判断user对象是否为null
   			c.如果为null,抛出异常UserNotFoundException(创建该异常)
   			d.如果不为null,从user对象中取出password,用password和页面输入的password比较
   			e.如果是true,state=1,message=登陆成功，返回user
   			f.如果是false,抛出异常PasswordNotMatchException(创建密码不匹配异常)
	3.登陆-控制层
		在UsreController类中定义方法
			a.跳转到登陆页面
			b.点击登陆时跳转到主页并绑定session
			c.验证用户名（ajax）
		在login.jsp中写登陆和验证用户名的ajax代码	
			写点击记住密码保存cookie的函数
		
	4.页面调整
		注册成功之后，跳转到登陆
		在注册的页面，点击直接登陆，跳转到登陆页面

**首页管理**
	1.登陆成功跳转到首页
	2.在index.jsp页面，显示用户名，在右上角	
		${user.username}	
	3.如果没有显示用户名，显示登陆，如果显示用户名，显示退出	
		引入标签库
		<c:if test="${user!=null}">退出</c:if>	
	4.点击登陆，跳转到登陆页面	
	5.点击退出，退出到首页，清除session
		在UserController,定义方法，完成退出的功能
		public String exit(HttpSession session){
			session.invalidate();
			return "../main/showIndex.do";
		}
	6.截取header.jsp，在index.jsp页面动态包含header.jsp
	7.点击用户名时，显示用户信息管理页面：	personal_password
		在UserController中定义方法，方法名showPersonal.do
		
***安全管理***		
		1.持久层
			a.在UserMapping接口中定义方法
					修改用户信息：void update(User user)
				在UserMapper.xml文件中，定义update节点，并写sql语句
				<update id="update" parameterType="....User">
					update t_user set 
						<if test="password!=null">
							password=#{password},
						</if>
						<if test="username!=null">
							username=#{username},
						</if>
						<if test="gender!=null">
							gender=#{gender},
						</if>
						<if test="email!=null">
							email=#{email},
						</if>
						<if test="phone!=null">
							phone=#{phone},
						</if>
						modified_user=#{modifiedUser},
						modified_time=#{modifiedTime} 
					 where id=#{id}
				</update>
				测试：修改密码成功
			b.创建方法User selectById()	
				在UserMapper.xml文件中，定义selectById方法
		
		2.业务层
			在IUserService接口中定义方法
				void changePassword(Integer id,String oldPwd,String newPwd)
			在UserService类中实现方法
				void changePassword(Integer id,String oldPwd,String newPwd){
					1.调用selectById得到用户
					2.判断user!=null，获取密码
					3.获取密码和oldPwd进行判断
					4.如果结果返回true
						User u=new User
						u.setId(..);u.setPassword()
					5.调用持久层update(u)
					6.返回false抛异常
				}
					
		3.控制器层
			在MainController中定于方法
				public ResponseResult<Void> password
			书写跳转到personInfo.jsp的代码
		4.  在personal_password.jsp中用jQuery写验证密码，点击提交的ajax语句
			调整各个按钮的连接地址及左边下拉列表的显示
		5.  在personInfo.jsp中调整页面以及各个连接
		
		6. 个人信息-修改
			a.持久层
			b.业务层			
				在IUserService定义方法
					void update(Integer id,String username,Integer gender,String phone,String email);
				在UserService中实现方法
				void update(Integer id,String username,Integer gender,String phone,String email){
					User user=new User();
					判断username是否存在
					User u1=userMapper.selectByUsername(username);
					如果u1==null||username.equals(u1.getUsername)//用户名为空或者是当前用户
						user.setUsername(username);
					否则
							抛出用户名已经存在的异常					
				}
			c.控制层
				UserController中添加public ResponseResult<Void> personInfo(HttpSession session, 
							String username,Integer gender,String phone,String email)方法
							
							方法中注意重新session绑定user
			
			d.处理页面personInfo.jsp保存更改的功能
		
		
***登陆拦截器**
		Filter:web组件，web容器	过滤web组件---jsp,servlet等
		Intercetor:spring组件  拦截controller---从前端到controller，从后端到前端时执行
		1.	拦截：showPersonInfo.do
					personInfo.do
					showPersonal.do
					personal.do
		2.	在store中创建拦截器的包intercept
				创建拦截器的类LoginInterceptor
				public class LoginInterceptor implements HandlerInterceptor{}	
					在perHandler方法中写：
						1.判断session user是否为null
						2.如果为null,重定向到登陆界面
						3.如果不为null,继续执行controller方法	
		3. 在spring-mvc.xml中配置拦截器
		
**地址管理******
		创建表t_address,省市区存对应编号
		create table t_address(
			id int auto_increment primary key,
			uid int not null,
			recv_name varchar(50) not null,
			recv_province varchar(6),
			recv_city varchar(6) not null,
			recv_area varchar(6) not null,
			recv_distric varchar(100) not null,
			recv_address varchar(100) not null,
			recv_phone varchar(32) not null,
			recv_tel varchar(32),
			recv_zip varchar(6),
			recv_tag varchar(10),
			created_user varchar(50),
			created_time date,
			modified_user varchar(50),
			modified_time date
		)engine=InnoDB default charset=utf8
		
		1.添加地址，新建地址管理控制器：AddressController
			a.显示页面并修改成.jsp格式，替换头部和左边栏
			b.制作地址三级联动菜单
				1.导入全国地址表t_dict.sql
				
				2.持久层
					1.创建Province实体类
						参照表的字段驼峰式创建bean
					2.创建DectMapper接口，定义方法selectProvince;
							List<Province> selectProvince();
					3.新建DictMapper.xml用于保存省信息查询等功能
						写查询语句
					4.测试持久层
				3.业务层	
					创建接口IDictService,并定义方法
						List<Province> getProvince();
					创建接口的实现类:DictService,实现方法
						public List<Province> getProvince(){}
				4.控制器层("/dict")
					创建控制器类：DictController
						创建方法：
							public ResponseResult<List<Province>> showProvince(){
								List<Province> provinces=dictService.getProvince();
							}
						
				
		
		
					